<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Bible Belt ‚Äî Clean Starter</title>

    <!-- Early theme to avoid flash -->
    <script>
        (function () {
            const key = "theme";
            const stored = localStorage.getItem(key);
            const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
            const theme = stored || (prefersDark ? "dark" : "light");
            document.documentElement.classList.toggle("dark", theme === "dark");
            document.documentElement.classList.toggle("light", theme !== "dark");
        })();
    </script>

    <link rel="stylesheet" href="styles.css" />

    <!-- Leaflet -->
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
</head>

<body>
    <header class="site-header">
        <div class="brand">
            <img src="assets/mybiblebelt-icon.png" alt="MyBibleBelt Logo" class="brand__img">
            <span>My Bible Belt</span>
        </div>

        <nav class="nav">
            <button class="nav-btn" data-tab="welcome">Welcome</button>
            <button class="nav-btn" data-tab="church">Church</button>
            <button class="nav-btn" data-tab="resources">Resources</button>
            <button class="nav-btn" data-tab="prayer">Prayer</button>
            <button class="nav-btn" data-tab="study">Study</button>
            <button class="nav-btn" data-tab="recovery">Recovery</button>
            <button class="nav-btn" data-tab="community">Community</button>
            <button class="nav-btn" data-tab="support">Support</button>
            <button id="themeToggle" class="icon-btn" title="Toggle theme">üåì</button>
        </nav>

        <div class="mobile-nav">
            <label for="mobileNav" class="sr-only">Navigate</label>
            <select id="mobileNav">
                <option value="welcome">Welcome</option>
                <option value="church">Church</option>
                <option value="resources">Resources</option>
                <option value="prayer">Prayer</option>
                <option value="study">Study</option>
                <option value="recovery">Recovery</option>
                <option value="community">Community</option>
                <option value="support">Support</option>
            </select>
            <button id="themeToggleMobile" class="icon-btn" title="Toggle theme (mobile)">üåì</button>
        </div>
    </header>

    <main>
        <!-- WELCOME -->
        <section id="welcome" class="tab">
            <div class="welcome__inner">
                <header class="welcome__header">
                    <h1 class="welcome__title">Welcome to MyBibleBelt.org</h1>
                    <p class="welcome__lead">
                        A place to grow in faith, find support, and connect with a caring community.
                    </p>
                </header>

                <div class="welcome__grid">
                    <a class="welcome__card card" href="#recovery">
                        <div class="welcome__icon">üìñ</div>
                        <h3 class="welcome__cardTitle">Recovery</h3>
                        <p class="welcome__cardText">Guided 10-step plan with space for reflection.</p>
                        <span class="welcome__cta">Open Recovery</span>
                    </a>

                    <a class="welcome__card card" href="#prayer">
                        <div class="welcome__icon">üôè</div>
                        <h3 class="welcome__cardTitle">Prayer</h3>
                        <p class="welcome__cardText">Requests, timer, and simple rules of prayer.</p>
                        <span class="welcome__cta">Go to Prayer</span>
                    </a>

                    <a class="welcome__card card" href="#resources">
                        <div class="welcome__icon">üåç</div>
                        <h3 class="welcome__cardTitle">Resources</h3>
                        <p class="welcome__cardText">Study tools across traditions incl. SDA.</p>
                        <span class="welcome__cta">Browse Resources</span>
                    </a>

                    <a class="welcome__card card" href="#community">
                        <div class="welcome__icon">üí¨</div>
                        <h3 class="welcome__cardTitle">Community</h3>
                        <p class="welcome__cardText">Chat, notes, and local projects.</p>
                        <span class="welcome__cta">Enter Community</span>
                    </a>
                </div>
            </div>
        </section>

        <!-- CHURCH -->
        <section id="church" class="tab hidden">
            <h1 class="page-title">Church Finder</h1>
            <p class="page-sub">Find nearby churches by location or city.</p>

            <div class="card">
                <div class="row gap">
                    <label class="pg-field grow">
                        <span class="pg-label">Search by city/town</span>
                        <input id="churchSearch" class="pg-input" placeholder="e.g., Knoxville, TN" />
                    </label>

                    <label class="pg-field w-160">
                        <span class="pg-label">Radius (miles)</span>
                        <select id="churchRadius" class="pg-input">
                            <option>3</option>
                            <option selected>5</option>
                            <option>10</option>
                            <option>15</option>
                        </select>
                    </label>
                </div>

                <div class="row gap mt">
                    <button id="churchUseMyLocation" class="btn primary">Use My Location</button>
                    <button id="churchSearchBtn" class="btn">Search City</button>
                    <button id="churchClearBtn" class="btn">Clear</button>
                </div>

                <div id="churchStatus" class="muted mt-8"></div>
            </div>

            <div class="grid-2 mt-16">
                <div class="card">
                    <div class="section-title">Map</div>
                    <div id="churchMap" class="map"></div>
                </div>

                <div class="card">
                    <div class="section-title">Nearby Churches</div>
                    <div id="churchResults" class="list mt"></div>
                </div>
            </div>
        </section>

        <!-- RESOURCES -->
        <section id="resources" class="tab hidden">
            <div class="card">
                <h2>Starter Kits</h2>

                <div class="row gap mt">
                    <input id="kitTitle" class="input" placeholder="Kit title e.g. Baptist ‚Äî Starter Kit" />
                    <input id="kitIntro" class="input" placeholder="Short intro" />
                </div>
                <div class="row gap mt">
                    <input id="kitStudy" class="input" placeholder="One study item (optional)" />
                    <button id="addKitBtn" class="btn">Add Kit</button>
                    <button id="clearKitFormBtn" class="btn ghost">Clear</button>
                </div>

                <div id="kitsGrid" class="grid mt"></div>
            </div>
        </section>

        <!-- PRAYER (trimmed UI) -->
        <section id="prayer" class="tab hidden">
            <div class="card">
                <h2>Prayer Tools</h2>
                <p class="muted">Build a simple prayer rule or use a timed session.</p>

                <div class="row gap mt">
                    <button id="btnCreateRule" class="btn">Create a Prayer Rule</button>
                    <button id="btnPrayNow" class="btn">Pray Now (Timer)</button>
                    <button id="btnPrayerRequest" class="btn ghost">Add Prayer Request</button>
                </div>
            </div>

            <dialog id="prayerDialog" class="pg-dialog">
                <div class="pg-dialog-card">
                    <h3>Prayer Request</h3>
                    <form id="prayerForm" method="dialog" class="stack">
                        <div class="row gap">
                            <label><input type="radio" name="reqType" value="For myself" checked /> For myself</label>
                            <label><input type="radio" name="reqType" value="For someone else" /> Someone else</label>
                        </div>
                        <input id="reqName" class="input" placeholder="Your name (optional)" />
                        <input id="reqEmail" class="input" placeholder="Your email (optional)" />
                        <textarea id="reqMessage" class="input" rows="4" placeholder="What can we pray for?"></textarea>
                        <div class="row gap mt">
                            <button class="btn">Save</button>
                            <button value="cancel" class="btn ghost">Cancel</button>
                        </div>
                    </form>
                    <button id="prayerModalClose" class="icon-close" title="Close" aria-label="Close">√ó</button>
                    <div data-close-modal class="pg-backdrop-close" aria-hidden="true"></div>
                </div>
            </dialog>
        </section>

        <!-- STUDY (trimmed) -->
        <section id="study" class="tab hidden">
            <div class="card">
                <h2>Study Library</h2>
                <p class="muted">Add links; data stays on this device.</p>
                <div id="studyLinksGrid" class="grid mt"></div>
            </div>
        </section>

        <!-- COMMUNITY (trimmed) -->
        <section id="community" class="tab hidden">
            <h1 class="page-title">Community</h1>
            <p class="page-sub">Connect, collaborate, and care for one another.</p>

            <div class="grid-2">
                <div class="card">
                    <div class="section-title">Video (Local Preview)</div>
                    <video id="communityVideo" playsinline autoplay muted class="video"></video>
                    <div class="row gap mt">
                        <button id="startCamBtn" class="btn">Start Camera</button>
                        <button id="stopCamBtn" class="btn">Stop</button>
                    </div>
                </div>

                <div class="card">
                    <div class="section-title">Chat</div>
                    <div id="communityChatMessages" class="chat"></div>
                    <div class="row gap mt">
                        <input id="communityChatInput" class="input" placeholder="Type a message‚Ä¶" />
                        <button id="sendCommunityMsgBtn" class="btn">Send</button>
                        <button id="clearCommunityChatBtn" class="btn">Clear</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- RECOVERY -->
        <section id="recovery-plan" data-print="recovery" class="tab hidden">
            <div class="card">
                <h2>Recovery Power in Christ</h2>
                <p class="muted">A gentle, practical plan with steps, scriptures, and local follow-up.</p>

                <div class="row gap mt">
                    <button id="printPlanBtn" class="btn">Print this Plan</button>
                    <button id="recoverySignUpBtn" class="btn">Sign Up for Follow-Up</button>
                    <div class="grow"></div>
                    <span id="recoveryAdminBadge" class="badge hidden">Admin</span>
                    <button id="recoveryAdminBtn" class="btn ghost">Admin</button>
                </div>

                <div id="recoveryAdminBar" class="admin-bar hidden">
                    <label class="row gap">
                        <input id="recoveryHidePublic" type="checkbox" />
                        <span>Hide signups publicly on this device</span>
                    </label>
                    <div class="grow"></div>
                    <button id="recoveryDownloadCsvBtn" class="btn ghost">Download CSV</button>
                    <button id="recoveryClearAllBtn" class="btn ghost">Clear All</button>
                </div>

                <div id="recovery-steps-appendix" class="mt">
                    <h3>Your Recovery Steps</h3>

                    <div id="recoverySteps" class="re-steps">
                        <!-- Steps 1‚Äì10 (each includes a textarea so you can see printing capture values) -->
                        <details class="re-step" data-step="1" open>
                            <summary><span class="step-num">1</span> Surrender & Honesty</summary>
                            <div class="re-body">
                                <p>Admit powerlessness; invite Christ into the mess with total honesty.</p>
                                <ul><li>Pray Psalm 51 (short & honest).</li><li>Tell one trusted person ‚ÄúI need help.‚Äù</li></ul>
                                <label class="mt">My note<textarea class="pg-textarea" rows="3" placeholder="Personal reflection‚Ä¶"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="2">
                            <summary><span class="step-num">2</span> Safety & Daily Rhythm</summary>
                            <div class="re-body">
                                <p>Stabilize day: sleep, food, movement, devotional block.</p>
                                <ul><li>Morning: 10 min scripture+prayer.</li><li>Text a buddy by noon.</li></ul>
                                <label class="mt">My note<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="3">
                            <summary><span class="step-num">3</span> Confession & Clean-up</summary>
                            <div class="re-body">
                                <p>Bring secrets to light; start small repairs.</p>
                                <label class="mt">My note<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="4">
                            <summary><span class="step-num">4</span> Triggers & Replacement</summary>
                            <div class="re-body">
                                <p>List top triggers and tie to replacement habits.</p>
                                <label class="mt">My triggers<textarea class="pg-textarea" rows="3" placeholder="- ‚Ä¶&#10;- ‚Ä¶"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="5">
                            <summary><span class="step-num">5</span> Scripture & Prayer Habits</summary>
                            <div class="re-body">
                                <p>Repeatable plan that fits real life.</p>
                                <label class="mt">Plan<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="6">
                            <summary><span class="step-num">6</span> Community & Mentor</summary>
                            <div class="re-body">
                                <p>Pick a mentor/sponsor; weekly check-in.</p>
                                <label class="mt">Names & group<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="7">
                            <summary><span class="step-num">7</span> Inventory & Amends Plan</summary>
                            <div class="re-body">
                                <p>Short moral inventory; safe first amends.</p>
                                <label class="mt">Notes<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="8">
                            <summary><span class="step-num">8</span> Boundaries & Tech Hygiene</summary>
                            <div class="re-body">
                                <p>Increase friction toward health.</p>
                                <label class="mt">Boundaries<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="9">
                            <summary><span class="step-num">9</span> Service & Mission</summary>
                            <div class="re-body">
                                <p>Weekly act of service; careful story-sharing.</p>
                                <label class="mt">Service idea<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <details class="re-step" data-step="10">
                            <summary><span class="step-num">10</span> Long-term Maintenance & Relapse Plan</summary>
                            <div class="re-body">
                                <p>Expect turbulence; prepare responses.</p>
                                <label class="mt">Relapse plan<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>
                    </div>
                </div>

                <div class="mt">
                    <h3>Follow-Up Signups</h3>
                    <div id="recoverySignupList" class="signup-wrap"><div class="muted">No sign ups yet.</div></div>
                </div>
            </div>

            <!-- Signup Modal -->
            <dialog id="recoveryModal" class="pg-dialog">
                <div class="pg-dialog-card">
                    <h3>Sign Up for Follow-Up</h3>
                    <form id="recoveryForm" class="stack">
                        <input name="fullName" class="input" placeholder="Full name" />
                        <input name="email" type="email" class="input" placeholder="Email (optional)" />
                        <input name="phone" class="input" placeholder="Phone (optional)" />
                        <label>
                            Preferred contact
                            <select name="preferred" class="input">
                                <option value="">Choose‚Ä¶</option>
                                <option>Email</option>
                                <option>Phone</option>
                                <option>Text</option>
                            </select>
                        </label>
                        <textarea name="notes" class="input" rows="3" placeholder="Notes (optional)"></textarea>
                        <label class="row gap">
                            <input name="consent" type="checkbox" />
                            <span>I consent to be contacted for follow-up.</span>
                        </label>
                        <div class="row gap mt">
                            <button class="btn">Submit</button>
                            <button id="recoveryCancel" type="button" class="btn ghost">Cancel</button>
                        </div>
                    </form>
                    <button id="recoveryModalClose" class="icon-close" aria-label="Close">√ó</button>
                    <div data-close-modal class="pg-backdrop-close" aria-hidden="true"></div>
                </div>
            </dialog>
        </section>

        <!-- SUPPORT -->
        <section id="support" class="tab hidden">
            <div class="card">
                <h2>Support</h2>
                <p>If this project helps you, you can support it below.</p>
                <div class="grid-2 mt">
                    <label>Amount (optional)<input id="supAmount" class="input" type="number" min="1" placeholder="e.g. 25" /></label>
                    <label>Note (optional)<input id="supNote" class="input" type="text" placeholder="e.g. Keep it up!" /></label>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">¬© <span id="year"></span> My Bible Belt</footer>

    <script src="app.js"></script>
</body>
</html>
