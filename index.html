<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Bible Belt ‚Äî Clean Starter</title>
    <link rel="stylesheet" href="styles.css" />

    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <style>
        /* minimal safe defaults in case styles.css is missing during testing */
        :root {
            --border: #ddd;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            margin: 0;
        }

        .hidden {
            display: none;
        }

        .site-header, .site-footer {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .site-footer {
            border-top: 1px solid var(--border);
            border-bottom: none;
        }

        .brand {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .nav-btn, .btn, .btn.ghost, .btn.primary {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: #f5f5f5;
            cursor: pointer;
        }

            .btn.primary {
                background: #385cf0;
                color: white;
                border-color: #385cf0;
            }

            .btn.ghost {
                background: transparent;
            }

        .icon-btn {
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #f5f5f5;
        }

        .page-title {
            margin: 0 0 4px 0;
        }

        .page-sub {
            margin: 0 0 12px 0;
            color: #666;
        }

        .card {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }

        .row {
            display: flex;
            align-items: center;
        }

        .gap {
            gap: 8px;
        }

        .grow {
            flex: 1;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        @media (min-width: 900px) {
            .grid-2 {
                grid-template-columns: 1fr 1fr;
            }
        }

        .input, .pg-input, .pg-textarea, textarea, input, select {
            width: 100%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .mt {
            margin-top: 12px;
        }

        .muted {
            color: #666;
        }

        .badge {
            background: #eee;
            padding: 4px 8px;
            border-radius: 999px;
        }

        .section-title {
            font-weight: 600;
        }

        details.re-step summary {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-num {
            display: inline-grid;
            place-items: center;
            width: 24px;
            height: 24px;
            border-radius: 999px;
            background: #385cf0;
            color: #fff;
            font-size: 12px;
        }

        dialog.pg-dialog {
            border: none;
            border-radius: 16px;
            padding: 0;
        }

        .pg-dialog-card {
            padding: 16px;
            min-width: min(560px, 90vw);
            position: relative;
        }

        .icon-close {
            position: absolute;
            right: 12px;
            top: 8px;
            border: none;
            background: transparent;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="brand">
            <img src="assets/mybiblebelt-icon.png" alt="MyBibleBelt Logo" style="width:36px; height:36px; border-radius:10px;">
            <span>My Bible Belt</span>
        </div>

        <nav class="nav">
            <button class="nav-btn" data-tab="welcome">Welcome</button>
            <button class="nav-btn" data-tab="church">Church</button>
            <button class="nav-btn" data-tab="resources">Resources</button>
            <button class="nav-btn" data-tab="prayer">Prayer</button>
            <button class="nav-btn" data-tab="study">Study</button>
            <button class="nav-btn" data-tab="recovery">Recovery</button>
            <button class="nav-btn" data-tab="community">Community</button>
            <button class="nav-btn" data-tab="support">Support</button>

            <button id="themeToggle" class="icon-btn" title="Toggle theme">üåì</button>
        </nav>

        <div class="mobile-nav" style="display:flex; gap:8px; align-items:center; margin-top:8px;">
            <label for="mobileNav" class="sr-only">Navigate</label>
            <select id="mobileNav">
                <option value="welcome">Welcome</option>
                <option value="church">Church</option>
                <option value="resources">Resources</option>
                <option value="prayer">Prayer</option>
                <option value="study">Study</option>
                <option value="recovery">Recovery</option>
                <option value="community">Community</option>
                <option value="support">Support</option>
            </select>
            <button id="themeToggleMobile" class="icon-btn" title="Toggle theme (mobile)">üåì</button>
        </div>
    </header>

    <main>
        <!-- Welcome -->
        <section id="welcome" class="welcome">
            <div class="welcome__inner">
                <header class="welcome__header">
                    <h1 class="welcome__title">Welcome to MyBibleBelt.org</h1>
                    <p class="welcome__lead">
                        A place to grow in faith, find support, and connect with a caring community.
                        Explore the sections below to get started.
                    </p>
                </header>

                <div class="welcome__grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px;">
                    <a class="welcome__card card" href="#recovery">
                        <div class="welcome__icon" aria-hidden="true">üìñ</div>
                        <h3 class="welcome__cardTitle">Recovery</h3>
                        <p class="welcome__cardText">A guided 10-step plan for spiritual and personal restoration with space for reflection.</p>
                        <span class="welcome__cta">Open Recovery</span>
                    </a>

                    <a class="welcome__card card" href="#prayer">
                        <div class="welcome__icon" aria-hidden="true">üôè</div>
                        <h3 class="welcome__cardTitle">Prayer</h3>
                        <p class="welcome__cardText">Share requests, join others in prayer, and receive strength through daily devotionals.</p>
                        <span class="welcome__cta">Go to Prayer</span>
                    </a>

                    <a class="welcome__card card" href="#resources">
                        <div class="welcome__icon" aria-hidden="true">üåç</div>
                        <h3 class="welcome__cardTitle">Resources</h3>
                        <p class="welcome__cardText">Study tools and teachings from across Christian traditions, including Seventh-day Adventist materials.</p>
                        <span class="welcome__cta">Browse Resources</span>
                    </a>

                    <a class="welcome__card card" href="#community">
                        <div class="welcome__icon" aria-hidden="true">üí¨</div>
                        <h3 class="welcome__cardTitle">Community</h3>
                        <p class="welcome__cardText">Watch, chat, take notes, and collaborate on local projects with others.</p>
                        <span class="welcome__cta">Enter Community</span>
                    </a>

                    <a class="welcome__card card" href="#church-finder">
                        <div class="welcome__icon" aria-hidden="true">üïäÔ∏è</div>
                        <h3 class="welcome__cardTitle">Church Finder</h3>
                        <p class="welcome__cardText">Locate nearby churches and ministries using your current location and an interactive map.</p>
                        <span class="welcome__cta">Find a Church</span>
                    </a>

                    <a class="welcome__card card" href="#affiliates">
                        <div class="welcome__icon" aria-hidden="true">ü§ù</div>
                        <h3 class="welcome__cardTitle">Affiliates</h3>
                        <p class="welcome__cardText">Meet local faith-friendly partners and businesses supporting the mission.</p>
                        <span class="welcome__cta">View Affiliates</span>
                    </a>
                </div>
            </div>
        </section>

        <!-- Church -->
        <section id="church" class="tab-section hidden">
            <h1 class="page-title">Church Finder</h1>
            <p class="page-sub">Find nearby churches by location or city.</p>

            <div class="card">
                <div class="row gap">
                    <div class="pg-field" style="flex:1;">
                        <label class="pg-label" for="churchSearch">Search by city/town</label>
                        <input id="churchSearch" class="pg-input" placeholder="e.g., Knoxville, TN" />
                    </div>
                    <div class="pg-field" style="width:140px;">
                        <label class="pg-label" for="churchRadius">Radius (miles)</label>
                        <select id="churchRadius" class="pg-input">
                            <option>3</option>
                            <option selected>5</option>
                            <option>10</option>
                            <option>15</option>
                        </select>
                    </div>
                </div>

                <div class="row gap mt">
                    <button id="churchUseMyLocation" class="btn primary">Use My Location</button>
                    <button id="churchSearchBtn" class="btn">Search City</button>
                    <button id="churchClearBtn" class="btn">Clear</button>
                </div>

                <div id="churchStatus" class="muted" style="margin-top:8px;"></div>
            </div>

            <div class="grid-2" style="margin-top:16px;">
                <div class="card">
                    <div class="section-title">Map</div>
                    <div id="churchMap" style="height: 420px; border:1px solid var(--border); border-radius: 12px; overflow:hidden;"></div>
                </div>

                <div class="card">
                    <div class="section-title">Nearby Churches</div>
                    <div id="churchResults" class="list mt"></div>
                </div>
            </div>
        </section>

        <!-- Resources -->
        <section id="resources" class="tab-section hidden">
            <div class="card">
                <h2>Starter Kits</h2>

                <div class="row gap mt">
                    <input id="kitTitle" class="input" placeholder="Kit title e.g. Baptist ‚Äî Starter Kit" />
                    <input id="kitIntro" class="input" placeholder="Short intro" />
                </div>
                <div class="row gap mt">
                    <input id="kitStudy" class="input" placeholder="One study item (optional)" />
                    <button id="addKitBtn" class="btn">Add Kit</button>
                    <button id="clearKitFormBtn" class="btn ghost">Clear</button>
                </div>

                <div id="kitsGrid" class="grid mt"></div>
            </div>
        </section>

        <!-- Prayer -->
        <section id="prayer" class="tab-section hidden">
            <div id="prayer-section" class="card">
                <h2>Prayer Tools</h2>
                <p class="muted" id="prayerInfo">Build a simple prayer rule or use a timed prayer session.</p>

                <div class="row gap mt">
                    <button id="btnCreateRule" class="btn">Create a Prayer Rule</button>
                    <button id="btnPrayNow" class="btn">Pray Now (Timer)</button>
                    <button id="btnPrayerRequest" class="btn ghost">Add Prayer Request</button>
                </div>

                <!-- (content trimmed for brevity; not needed for print demo) -->
            </div>

            <!-- Prayer Request Modal -->
            <dialog id="prayerDialog" class="pg-dialog">
                <div class="pg-dialog-card">
                    <h3>Prayer Request</h3>
                    <form id="prayerForm" method="dialog" class="stack">
                        <div class="row gap">
                            <label><input type="radio" name="reqType" value="For myself" checked /> For myself</label>
                            <label><input type="radio" name="reqType" value="For someone else" /> For someone else</label>
                        </div>
                        <input id="reqName" class="input" placeholder="Your name (optional)" />
                        <input id="reqEmail" class="input" placeholder="Your email (optional)" />
                        <textarea id="reqMessage" class="input" placeholder="What can we pray for?" rows="4"></textarea>
                        <div class="row gap">
                            <label><input type="radio" name="privacy" value="Private" checked /> Private</label>
                            <label><input type="radio" name="privacy" value="Share with group" /> Share with group</label>
                        </div>
                        <div class="row gap mt">
                            <button id="btnSubmitRequest" class="btn">Save</button>
                            <button value="cancel" class="btn ghost">Cancel</button>
                        </div>
                    </form>
                    <button id="prayerModalClose" class="icon-close" title="Close" aria-label="Close">√ó</button>
                    <div data-close-modal class="pg-backdrop-close" aria-hidden="true"></div>
                </div>
            </dialog>
        </section>

        <!-- Study -->
        <section id="study" class="tab-section hidden">
            <div class="card">
                <h2>Study Library</h2>
                <p class="muted">Links to materials by tradition. Add your own favorites; everything is saved on this device.</p>
                <div id="studyLinksGrid" class="grid mt"></div>

                <div class="row gap mt">
                    <button id="studyExportLinksBtn" class="btn">Export Links CSV</button>
                    <button id="studyClearLinksBtn" class="btn ghost">Clear All Links</button>
                </div>
            </div>

            <div class="card" style="margin-top:16px;">
                <h2>My Study Card</h2>
                <p class="muted">Create a quick study plan or note you can save, copy, or download.</p>

                <div class="grid-2 mt">
                    <label>
                        Title
                        <input id="scTitle" class="input" placeholder="e.g., Beatitudes Study">
                    </label>
                    <label>
                        Passage / Source
                        <input id="scPassage" class="input" placeholder="e.g., Matthew 5:1‚Äì12">
                    </label>
                </div>

                <label class="mt">
                    Key Notes (Markdown ok)
                    <textarea id="scNotes" class="pg-textarea" rows="6" placeholder="- Main points&#10;- Questions&#10;- Cross references"></textarea>
                </label>
            </div>
        </section>

        <!-- COMMUNITY (trimmed UI kept functional for demo) -->
        <section id="community" class="tab-section hidden">
            <h1 class="page-title">Community</h1>
            <p class="page-sub">Connect, collaborate, and care for one another.</p>

            <div class="grid-2">
                <div class="card">
                    <div class="section-title">Video (Local Preview)</div>
                    <p class="muted" style="margin-top:6px">
                        This is a private, on-device camera preview (no upload).
                    </p>
                    <div class="mt">
                        <video id="communityVideo" playsinline autoplay muted style="width:100%; border-radius:12px; border:1px solid var(--border); background:#000; min-height: 220px;"></video>
                    </div>
                    <div class="row gap mt">
                        <button id="startCamBtn" class="btn">Start Camera</button>
                        <button id="stopCamBtn" class="btn">Stop</button>
                    </div>
                </div>

                <div class="card">
                    <div class="section-title">Chat</div>
                    <div id="communityChatMessages" class="chat-messages" style="height:280px; border:1px solid var(--border); border-radius:12px; padding:8px; overflow:auto;"></div>
                    <div class="row gap mt">
                        <input id="communityChatInput" class="input" placeholder="Type a message‚Ä¶" />
                        <button id="sendCommunityMsgBtn" class="btn">Send</button>
                        <button id="clearCommunityChatBtn" class="btn">Clear</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- RECOVERY (id must be #recovery-plan for print) -->
        <section id="recovery-plan" data-print="recovery" class="tab-section hidden">
            <div class="card">
                <h2>Recovery Power in Christ</h2>
                <p class="muted">A gentle, practical plan with steps, scriptures, and local follow-up. All data stays in your browser unless you export it.</p>

                <div class="row gap mt">
                    <button id="printPlanBtn" class="btn">Print this Plan</button>
                    <button id="recoverySignUpBtn" class="btn">Sign Up for Follow-Up</button>

                    <span id="recoveryAdminBadge" class="badge hidden">Admin</span>
                    <div class="grow"></div>
                    <button id="recoveryAdminBtn" class="btn ghost">Admin</button>
                </div>

                <!-- Admin toolbar -->
                <div id="recoveryAdminBar" class="admin-bar hidden">
                    <label class="row gap">
                        <input id="recoveryHidePublic" type="checkbox" />
                        <span>Hide signups publicly on this device</span>
                    </label>
                    <div class="grow"></div>
                    <button id="recoveryDownloadCsvBtn" class="btn ghost">Download CSV</button>
                    <button id="recoveryClearAllBtn" class="btn ghost">Clear All</button>
                </div>

                <div id="recovery-steps-appendix" class="mt">
                    <h3>Your Recovery Steps</h3>

                    <div id="recoverySteps" class="re-steps">
                        <!-- 1 -->
                        <details class="re-step" data-step="1" open>
                            <summary><span class="step-num">1</span> Surrender & Honesty</summary>
                            <div class="re-body">
                                <p>Admit powerlessness over addiction and invite Christ into the mess with total honesty.</p>
                                <ul>
                                    <li>Pray Psalm 51 (short & honest).</li>
                                    <li>Tell one trusted person ‚ÄúI need help.‚Äù</li>
                                    <li>Remove obvious access/temptations today.</li>
                                </ul>
                                <label class="mt">My note<textarea class="pg-textarea" rows="3" placeholder="Personal reflection‚Ä¶"></textarea></label>
                            </div>
                        </details>

                        <!-- 2 -->
                        <details class="re-step" data-step="2">
                            <summary><span class="step-num">2</span> Safety & Daily Rhythm</summary>
                            <div class="re-body">
                                <p>Stabilize your day. Sleep, food, movement, and a short devotional block.</p>
                                <ul>
                                    <li>Morning: 10 minutes (scripture + prayer).</li>
                                    <li>Text a check-in buddy by noon.</li>
                                    <li>Evening: brief review; gratitude for 3 things.</li>
                                </ul>
                                <label class="mt">My note<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <!-- 3 -->
                        <details class="re-step" data-step="3">
                            <summary><span class="step-num">3</span> Confession & Clean-up</summary>
                            <div class="re-body">
                                <p>Bring secrets into the light in safe community; start repairing fallout in small pieces.</p>
                                <ul>
                                    <li>Confess to a trusted leader/mentor.</li>
                                    <li>Identify one immediate mess to clean up this week.</li>
                                </ul>
                                <label class="mt">My note<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <!-- 4 -->
                        <details class="re-step" data-step="4">
                            <summary><span class="step-num">4</span> Triggers & Replacement</summary>
                            <div class="re-body">
                                <p>Spot your top triggers and practice replacement habits instead of white-knuckling.</p>
                                <ul>
                                    <li>List top 5 triggers (people/places/feelings).</li>
                                    <li>Pair each trigger with a 5-minute replacement action.</li>
                                </ul>
                                <label class="mt">My triggers<textarea class="pg-textarea" rows="3" placeholder="- ‚Ä¶&#10;- ‚Ä¶"></textarea></label>
                            </div>
                        </details>

                        <!-- 5 -->
                        <details class="re-step" data-step="5">
                            <summary><span class="step-num">5</span> Scripture & Prayer Habits</summary>
                            <div class="re-body">
                                <p>Build a simple, repeatable devotional plan that fits your real life.</p>
                                <ul>
                                    <li>Read one Psalm + one Gospel paragraph daily.</li>
                                    <li>Use breath prayers when cravings rise (e.g., ‚ÄúLord Jesus, have mercy‚Äù).</li>
                                </ul>
                                <label class="mt">Plan<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <!-- 6 -->
                        <details class="re-step" data-step="6">
                            <summary><span class="step-num">6</span> Community & Mentor</summary>
                            <div class="re-body">
                                <p>Recovery is a team sport‚Äîdon‚Äôt walk alone.</p>
                                <ul>
                                    <li>Choose a mentor/sponsor and set a weekly check-in.</li>
                                    <li>Join a small group or recovery meeting.</li>
                                </ul>
                                <label class="mt">Names & group<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <!-- 7 -->
                        <details class="re-step" data-step="7">
                            <summary><span class="step-num">7</span> Inventory & Amends Plan</summary>
                            <div class="re-body">
                                <p>Make a gentle, honest inventory and draft safe amends with counsel.</p>
                                <ul>
                                    <li>Write a short moral inventory (facts, not self-hate).</li>
                                    <li>With guidance, identify one safe amends to attempt first.</li>
                                </ul>
                                <label class="mt">Notes<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <!-- 8 -->
                        <details class="re-step" data-step="8">
                            <summary><span class="step-num">8</span> Boundaries & Tech Hygiene</summary>
                            <div class="re-body">
                                <p>Reduce friction toward relapse; increase friction toward health.</p>
                                <ul>
                                    <li>Content filters, app limits, bedtime mode, accountability tools.</li>
                                    <li>Physical boundaries: routes, environments, cash/card limits.</li>
                                </ul>
                                <label class="mt">Boundaries<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <!-- 9 -->
                        <details class="re-step" data-step="9">
                            <summary><span class="step-num">9</span> Service & Mission</summary>
                            <div class="re-body">
                                <p>Move from only avoiding harm to doing good‚Äîservice fuels hope.</p>
                                <ul>
                                    <li>Pick a weekly act of service (small, consistent).</li>
                                    <li>Share your story carefully with someone who needs hope.</li>
                                </ul>
                                <label class="mt">Service idea<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>

                        <!-- 10 -->
                        <details class="re-step" data-step="10">
                            <summary><span class="step-num">10</span> Long-term Maintenance & Relapse Plan</summary>
                            <div class="re-body">
                                <p>Expect turbulence; prepare responses ahead of time.</p>
                                <ul>
                                    <li>Write a 1-page relapse response: who to call, what to do first.</li>
                                    <li>Monthly review: triggers, wins, amends progress, next right step.</li>
                                </ul>
                                <label class="mt">Relapse plan<textarea class="pg-textarea" rows="3"></textarea></label>
                            </div>
                        </details>
                    </div>
                </div>

                <!-- Signups List -->
                <div class="mt">
                    <h3>Follow-Up Signups</h3>
                    <div id="recoverySignupList" class="signup-wrap">
                        <div class="muted">No sign ups yet.</div>
                    </div>
                </div>
            </div>

            <!-- Signup Modal -->
            <dialog id="recoveryModal" class="pg-dialog">
                <div class="pg-dialog-card">
                    <h3>Sign Up for Follow-Up</h3>
                    <form id="recoveryForm" class="stack" method="dialog">
                        <input name="fullName" class="input" placeholder="Full name" />
                        <input name="email" type="email" class="input" placeholder="Email (optional)" />
                        <input name="phone" class="input" placeholder="Phone (optional)" />
                        <label>
                            Preferred contact
                            <select name="preferred" class="input">
                                <option value="">Choose‚Ä¶</option>
                                <option>Email</option>
                                <option>Phone</option>
                                <option>Text</option>
                            </select>
                        </label>
                        <textarea name="notes" class="input" rows="3" placeholder="Notes (optional)"></textarea>
                        <label class="row gap">
                            <input name="consent" type="checkbox" />
                            <span>I consent to be contacted for follow-up.</span>
                        </label>

                        <div class="row gap mt">
                            <button class="btn">Submit</button>
                            <button id="recoveryCancel" type="button" class="btn ghost">Cancel</button>
                        </div>
                    </form>
                    <button id="recoveryModalClose" class="icon-close" title="Close" aria-label="Close">√ó</button>
                    <div data-close-modal class="pg-backdrop-close" aria-hidden="true"></div>
                </div>
            </dialog>
        </section>

        <!-- Support -->
        <section id="support" class="tab-section hidden">
            <div class="card">
                <h2>Support</h2>
                <p>If this project helps you, you can support it below.</p>

                <div class="grid-2" style="margin-top:12px;">
                    <label>
                        Amount (optional)
                        <input id="supAmount" class="input" type="number" min="1" placeholder="e.g. 25" />
                    </label>
                    <label>
                        Note (optional)
                        <input id="supNote" class="input" type="text" placeholder="e.g. Keep it up!" />
                    </label>
                </div>

                <div class="grid-2" style="margin-top:16px;">
                    <div class="info-tile">
                        <h4 style="margin:0 0 6px;">PayPal</h4>
                        <div class="row gap">
                            <button id="ppOpen" class="btn">Open</button>
                            <button id="ppCopy" class="btn ghost">Copy handle</button>
                        </div>
                    </div>

                    <div class="info-tile">
                        <h4 style="margin:0 0 6px;">Cash App</h4>
                        <div class="row gap">
                            <button id="caOpen" class="btn">Open</button>
                            <button id="caCopy" class="btn ghost">Copy $tag</button>
                        </div>
                    </div>

                    <div class="info-tile">
                        <h4 style="margin:0 0 6px;">Venmo</h4>
                        <div class="row gap">
                            <button id="vmApp" class="btn">Open app</button>
                            <button id="vmWeb" class="btn">Open web</button>
                            <button id="vmCopy" class="btn ghost">Copy @user</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="site-footer">
        <div>¬© <span id="year"></span> My Bible Belt</div>
    </footer>

    <!-- Self-contained JS to make tabs + modal + PRINT work -->
    <script>
        (function () {
            // ----- Helpers
            const $ = (sel, ctx = document) => ctx.querySelector(sel);
            const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));

            // ----- Year
            $('#year').textContent = new Date().getFullYear();

            // ----- Theme toggles
            function toggleTheme() {
                const html = document.documentElement;
                html.classList.toggle('dark');
                html.classList.toggle('light');
            }
            $('#themeToggle')?.addEventListener('click', toggleTheme);
            $('#themeToggleMobile')?.addEventListener('click', toggleTheme);

            // ----- Tabs (map "recovery" to section id "recovery-plan")
            const idForTab = (tab) => tab === 'recovery' ? 'recovery-plan' : tab;

            function showTab(tab) {
                const id = idForTab(tab);
                $$('.welcome, .tab-section').forEach(s => s.classList.add('hidden'));
                const sec = document.getElementById(id);
                if (sec) sec.classList.remove('hidden');

                // update selects
                const mobile = $('#mobileNav');
                if (mobile && mobile.value !== tab) mobile.value = tab;

                // hash
                if (location.hash !== '#' + tab) history.replaceState(null, '', '#' + tab);
            }

            $$('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => showTab(btn.dataset.tab));
            });
            $('#mobileNav')?.addEventListener('change', (e) => showTab(e.target.value));

            // initial tab from hash (default to welcome)
            const startTab = (location.hash || '#welcome').replace('#', '');
            showTab(startTab);

            // ----- Recovery modal open/close (minimal)
            const recModal = $('#recoveryModal');
            $('#recoverySignUpBtn')?.addEventListener('click', () => recModal.showModal());
            $('#recoveryModalClose')?.addEventListener('click', () => recModal.close());
            $('#recoveryCancel')?.addEventListener('click', () => recModal.close());
            $('[data-close-modal]')?.addEventListener('click', () => recModal.close());

            // ----- PRINT: clone #recovery-plan, convert inputs to values, write to popup, print
            function serializeForPrint(root) {
                const clone = root.cloneNode(true);

                // Expand all steps for print
                clone.querySelectorAll('details').forEach(d => d.setAttribute('open', ''));

                // Convert inputs/selects/textareas to plain text values
                clone.querySelectorAll('input, textarea, select').forEach(el => {
                    let value = '';
                    const tag = el.tagName;
                    if (tag === 'TEXTAREA') {
                        value = el.value.trim();
                    } else if (tag === 'SELECT') {
                        value = el.options[el.selectedIndex]?.text ?? '';
                    } else if (el.type === 'checkbox') {
                        value = el.checked ? '‚úì Yes' : '‚Äî';
                    } else if (el.type === 'radio') {
                        if (!el.checked) { el.remove(); return; }
                        value = el.value;
                    } else {
                        value = el.value ?? '';
                    }

                    const span = document.createElement('span');
                    span.className = 'print-value';
                    span.textContent = value || '‚Äî';

                    // Try to pair with label
                    const wrapper = document.createElement('div');
                    wrapper.className = 'print-field';

                    let labelText = '';
                    if (el.id) {
                        const lbl = clone.querySelector(`label[for="${el.id}"]`);
                        if (lbl) labelText = lbl.textContent.trim();
                    } else {
                        const lbl = el.closest('label');
                        if (lbl) labelText = lbl.textContent.trim();
                    }

                    if (labelText) {
                        const strong = document.createElement('strong');
                        strong.textContent = labelText.replace(/\*\s*$/, '') + ': ';
                        wrapper.appendChild(strong);
                        wrapper.appendChild(span);
                        el.replaceWith(wrapper);
                    } else {
                        el.replaceWith(span);
                    }
                });

                // Remove UI-only elements
                clone.querySelectorAll('#recoveryAdminBar, #recoveryAdminBtn, #recoverySignUpBtn, #printPlanBtn, .icon-close, dialog, button').forEach(n => n.remove());

                return clone.outerHTML;
            }

            function openPrintWindow(htmlBody, title = 'Recovery Plan') {
                const win = window.open('', 'PrintPlan', 'width=900,height=700,noopener');
                if (!win) {
                    alert('Popup was blocked. Please allow popups for this site and try again.');
                    return;
                }
                const styles = `
              <style>
                :root { color-scheme: light dark; }
                body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.5; padding: 24px; }
                h1 { margin: 0 0 .5rem; font-size: 1.6rem; }
                .meta { color: #666; font-size: .95rem; margin-bottom: 1rem; }
                .print-field { margin: .25rem 0; }
                .print-field strong { font-weight: 600; }
                .print-value { white-space: pre-wrap; }
                details { margin: 12px 0; }
                summary { font-weight: 600; margin-bottom: 6px; }
                @media print { body { padding: 0; } }
              </style>
            `;
                const now = new Date();
                win.document.open();
                win.document.write(`<!doctype html>
<html><head><meta charset="utf-8"><title>${title}</title>${styles}</head>
<body>
      <h1>${title}</h1>
      <div class="meta">Generated on ${now.toLocaleString()}</div>
      ${htmlBody}
      <script>window.onload=function(){setTimeout(function(){window.print();},120);};<\/script>
</body></html>`);
                win.document.close();
            }

            function handlePrint() {
                const source = document.getElementById('recovery-plan');
                if (!source) {
                    alert('Recovery Plan section not found.');
                    return;
                }
                const html = serializeForPrint(source);
                openPrintWindow(html, 'Recovery Plan');
            }

            $('#printPlanBtn')?.addEventListener('click', handlePrint);
        })();
    </script>

    <!-- If you still want to keep external JS, you can include it AFTER the inline script.
         <script src="app.js"></script> -->
</body>
</html>
